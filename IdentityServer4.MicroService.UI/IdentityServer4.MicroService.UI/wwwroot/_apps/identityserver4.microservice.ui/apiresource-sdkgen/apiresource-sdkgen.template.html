<div class="container-fluid">
    <loading ng-show="$ctrl.loading_getVersions"></loading>
    <h1>SDK 生成 - {{$ctrl.versions[0].name}}</h1>
    <p class="alert alert-primary">{{$ctrl.versions[0].description}}</p>
        <div class="row">
            <div class="col">
                <ul class="nav nav-tabs" role="tablist" ng-init="tabIndex=0">
                    <li class="nav-item" ng-click="tabIndex=0">
                        <a class="nav-link btn" ng-class="{active:tabIndex==0}">发布 SDK</a>
                    </li>
                    <li class="nav-item" ng-class="{active:tabIndex==1}" ng-click="tabIndex=1">
                        <a class="nav-link btn" ng-class="{active:tabIndex==1}">SDK 配置</a>
                    </li>
                    <li class="nav-item" ng-class="{active:tabIndex==2}" ng-click="tabIndex=2">
                        <a class="nav-link btn" ng-class="{active:tabIndex==2}">SDK 包市场</a>
                    </li>
                </ul>
                <div class="tab-content pt-3">
                    <div class="tab-pane fade" ng-class="{'show active':tabIndex==0}" role="tabpanel">
                        <table class="table table-bordered">
                            <thead>
                                <tr class="thead-light">
                                    <th>微服务版本</th>
                                    <th colspan="3">发布SDK</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr ng-repeat="x in $ctrl.versions" class="text-center">
                                    <td>
                                        <span class="badge badge-success">V{{x.apiRevision}}</span>
                                    </td>
                                    <td>
                                        <div class="btn-group">
                                            <button type="button" class="btn btn-primary btn-sm" ng-click="$ctrl.releasePackage(x.id,0)">发布Angular2</button>
                                            <button type="button" class="btn btn-primary btn-sm dropdown-toggle dropdown-toggle-split" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                                <span class="sr-only">Toggle Dropdown</span>
                                            </button>
                                            <div class="dropdown-menu">
                                                <a class="dropdown-item" href="javascript:void(0)" ng-click="$ctrl.configView(0)">发布配置</a>
                                            </div>
                                        </div>
                                    </td>
                                    <td>
                                        <div class="btn-group">
                                            <button type="button" class="btn btn-primary btn-sm" ng-click="$ctrl.releasePackage(x.id,1)">发布jQuery</button>
                                            <button type="button" class="btn btn-primary btn-sm dropdown-toggle dropdown-toggle-split" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                                <span class="sr-only">Toggle Dropdown</span>
                                            </button>
                                            <div class="dropdown-menu">
                                                <a class="dropdown-item" href="javascript:void(0)" ng-click="$ctrl.configView(1)">发布配置</a>
                                            </div>
                                        </div>
                                    </td>
                                    <td>
                                        <div class="btn-group">
                                            <button type="button" class="btn btn-primary btn-sm" ng-click="$ctrl.syncGithub()">发布产品文档</button>
                                            <button type="button" class="btn btn-primary btn-sm dropdown-toggle dropdown-toggle-split" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                                <span class="sr-only">Toggle Dropdown</span>
                                            </button>
                                            <div class="dropdown-menu">
                                                <a class="dropdown-item" href="javascript:void(0)" ng-click="$ctrl.configView(2)">发布配置</a>
                                            </div>
                                        </div>
                                    </td>
                                </tr>
                                <tr>
                                    <td></td>
                                    <td>
                                        <ul>
                                            <li ng-repeat="x in $ctrl.histories" ng-if="x.language=='angular2'">
                                                <p class="font-weight-bold mb-0">
                                                    <span class="text-secondary font-weight-normal">{{x.releaseDate}}</span>
                                                    {{x.rowKey.split('@')[0]}}@<font class="text-primary">{{x.version}}</font>
                                                </p>
                                                <p class="badge badge-light font-weight-normal">{{x.swaggerUrl}}</p>
                                            </li>
                                        </ul>
                                    </td>
                                    <td>
                                        <ul>
                                            <li ng-repeat="x in $ctrl.histories" ng-if="x.language=='jQuery'">
                                                <p class="font-weight-bold mb-0">
                                                    <span class="text-secondary font-weight-normal">{{x.releaseDate}}</span>
                                                    {{x.rowKey.split('@')[0]}}@<font class="text-primary">{{x.version}}</font>
                                                </p>
                                                <p class="badge badge-light font-weight-normal">{{x.swaggerUrl}}</p>
                                            </li>
                                        </ul>
                                    </td>
                                    <td>
                                        <ul>
                                            <li ng-repeat="x in $ctrl.histories" ng-if="x.language=='github'">
                                                <p class="font-weight-bold mb-0">
                                                    <span class="text-secondary font-weight-normal">{{x.releaseDate}}</span>
                                                    {{x.rowKey.split('@')[0]}}@<font class="text-primary">{{x.version}}</font>
                                                </p>
                                                <p class="badge badge-light font-weight-normal">{{x.swaggerUrl}}</p>
                                            </li>
                                        </ul>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <div class="tab-pane fade" ng-class="{'show active':tabIndex==1}" role="tabpanel">
                        <div class="card">
                            <div class="card-header">
                                <ul class="nav nav-tabs card-header-tabs" ng-init="tab2Index=3;$ctrl.getCommonOptions()">
                                    <li class="nav-item">
                                        <a class="nav-link btn" ng-class="{active:tab2Index==3}" ng-click="tab2Index=3;$ctrl.getCommonOptions()">基本配置</a>
                                    </li>
                                    <li class="nav-item">
                                        <a class="nav-link btn" ng-class="{active:tab2Index==0}" ng-click="tab2Index=0;$ctrl.getNPMOptions(0)">Angular2 SDK</a>
                                    </li>
                                    <li class="nav-item">
                                        <a class="nav-link btn" ng-class="{active:tab2Index==1}" ng-click="tab2Index=1;$ctrl.getNPMOptions(1)">JQuery SDK</a>
                                    </li>
                                    <li class="nav-item">
                                        <a class="nav-link btn" ng-class="{active:tab2Index==2}" ng-click="tab2Index=2;$ctrl.getGithubOptions(2)">产品文档（Github）</a>
                                    </li>
                                </ul>
                            </div>
                            <div class="card-body">
                                <loading ng-show="$ctrl.loading_getNPMOptions"></loading>
                                <form ng-submit="$ctrl.setNPMOptions()" ng-show="tab2Index<2&&!$ctrl.loading_getNPMOptions">
                                    <div class="form-group">
                                        <label>Npm 包名称（小写字母与数字组成）</label>
                                        <input class="form-control" type="text" ng-model="$ctrl.npmOptions.name" maxlength="50" />
                                    </div>

                                    <div class="form-group">
                                        <label>SDK Class Name</label>
                                        <input class="form-control" type="text" ng-model="$ctrl.npmOptions.sdkName" maxlength="20" />
                                    </div>

                                    <div class="form-group">
                                        <label>Npm token</label>
                                        <input class="form-control" type="text" ng-model="$ctrl.npmOptions.token" />
                                    </div>

                                    <div class="row">
                                        <div class="col">
                                            <div class="form-group">
                                                <label>版本（会自动更新）</label>
                                                <input class="form-control" type="text" ng-model="$ctrl.npmOptions.version" maxlength="20" />
                                            </div>
                                        </div>
                                        <div class="col">
                                            <div class="form-group">
                                                <label>作者</label>
                                                <input class="form-control" type="text" ng-model="$ctrl.npmOptions.author" maxlength="20" />
                                            </div>
                                        </div>
                                    </div>

                                    <div class="row">
                                        <div class="col">
                                            <div class="form-group">
                                                <label>主页</label>
                                                <input class="form-control" type="text" ng-model="$ctrl.npmOptions.homepage" />
                                            </div>
                                        </div>
                                        <div class="col">
                                            <div class="form-group">
                                                <label>授权协议</label>
                                                <input class="form-control" type="text" ng-model="$ctrl.npmOptions.license" maxlength="20" />
                                            </div>
                                        </div>
                                    </div>

                                    <div class="form-group">
                                        <label>README.md</label>
                                        <textarea class="form-control" rows="20" ng-model="$ctrl.npmOptions.readme"></textarea>
                                    </div>

                                    <div class="form-group">
                                        <label>介绍</label>
                                        <textarea class="form-control" ng-model="$ctrl.npmOptions.description" rows="2"></textarea>
                                    </div>

                                    <div class="form-group">
                                        <input type="submit" value="提交" class="btn btn-primary" />
                                    </div>
                                </form>

                                <form ng-submit="$ctrl.setGithubOptions()" ng-show="tab2Index==2&&!$ctrl.loading_getNPMOptions">
                                    <div class="container-fluid">
                                        <div class="row">
                                            <div class="col card mr-3 pt-4">
                                                <div class="form-group">
                                                    <label>账号 <small>github.com/<code>{账号}</code>/xxx</small></label>
                                                    <input class="form-control" type="text" ng-model="$ctrl.githubOptions.owner" />
                                                </div>

                                                <div class="form-group">
                                                    <label>项目名称 <small>github.com/xxx/<code>{项目名称}</code></small></label>
                                                    <input class="form-control" type="text" ng-model="$ctrl.githubOptions.repo" />
                                                </div>

                                                <div class="form-group">
                                                    <label>SwaggerUrl（网关/直连）</label>
                                                    <input class="form-control" type="text" ng-model="$ctrl.githubOptions.swaggerUrl" />
                                                </div>

                                                <div class="form-group">
                                                    AccessToken
                                                    <a href="https://github.com/apps/identityserver4-microservice"
                                                       target="_blank"
                                                       title="请授权拥有所有repo权限"
                                                       class="btn btn-link btn-sm">1，安装id4.ms App</a>

                                                    <button type="button" ng-click="$ctrl.getGithubToken()" class="btn btn-link btn-sm">
                                                        2，获取Token
                                                    </button>

                                                    <input class="form-control" type="text" ng-model="$ctrl.githubOptions.token" />
                                                </div>

                                                <div class="form-group">
                                                    <label>用户代理</label>
                                                    <input class="form-control" type="text" ng-model="$ctrl.githubOptions.userAgent" />
                                                </div>

                                                <div class="form-group">
                                                    <input type="submit" class="btn btn-primary" value="更新配置" />
                                                </div>
                                            </div>
                                            <div class="col card pt-4">
                                                <div class="alert alert-warning" role="alert">
                                                    功能说明：启用后，如果Github项目不存在，将自动创建。
                                                </div>

                                                <div class="form-group">
                                                    <div class="form-check">
                                                        <input class="form-check-input" type="checkbox" id="syncLabelsEnabled"
                                                               ng-checked="$ctrl.githubOptions.syncLabels" ng-model="$ctrl.githubOptions.syncLabels">
                                                        <label class="form-check-label" for="syncLabelsEnabled">
                                                            为每个接口生成issue标签
                                                        </label>
                                                    </div>
                                                </div>

                                                <div class="form-group">
                                                    <div class="form-check">
                                                        <input class="form-check-input" type="checkbox" id="syncDocsEnabled"
                                                               ng-checked="$ctrl.githubOptions.syncDocs" ng-model="$ctrl.githubOptions.syncDocs">
                                                        <label class="form-check-label" for="syncDocsEnabled">
                                                            生成产品文档 <a href="https://readthedocs.org/" target="_blank" class="btn btn-sm">?</a>
                                                        </label>
                                                    </div>
                                                </div>
                                                <div class="form-group">
                                                    <button type="button" ng-click="$ctrl.syncGithub()" ng-disabled="$ctrl.loading_syncGithub"
                                                            class="btn btn-primary">
                                                        立即同步
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </form>

                                <form ng-submit="$ctrl.setCommonOptions()" ng-show="tab2Index==3&&!$ctrl.loading_getNPMOptions">
                                    <div class="form-group">
                                        <label>swaggerUrl</label>
                                        <input class="form-control" type="text" ng-model="$ctrl.commonOptions.swaggerUrl" />
                                        <small class="form-text text-muted">将根据这个swaggerUrl进行SDK生成。可以是网关的swagger，也可以是项目直连的swagger</small>
                                    </div>

                                    <div class="form-group">
                                        <input type="submit" value="提交" class="btn btn-primary" />
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>

                    <div class="tab-pane fade" ng-class="{'show active':tabIndex==2}" role="tabpanel">
                        <loading ng-show="$ctrl.loading_packages"></loading>
                        <table class="table" ng-show="!$ctrl.loading_packages">
                            <thead>
                                <tr class="thead-light">
                                    <th>#</th>
                                    <th>标识</th>
                                    <th>平台</th>
                                    <th>语言</th>
                                    <th>标签</th>
                                    <th>描述</th>
                                    <th>链接</th>
                                    <th>图标</th>
                                    <th>发布者</th>
                                    <th>排序</th>
                                    <th></th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr class="table-warning">
                                    <td></td>
                                    <td>
                                        <input type="text" class="form-control" ng-model="$ctrl.package.name" />
                                    </td>
                                    <td>
                                        <select class="form-control" ng-model="$ctrl.package.packagePlatform" ng-options="item for item in $ctrl.packagePlatforms"></select>
                                    </td>
                                    <td><input type="text" class="form-control" ng-model="$ctrl.package.language" /></td>
                                    <td><input type="text" class="form-control" ng-model="$ctrl.package.tags" /></td>
                                    <td><textarea class="form-control" ng-model="$ctrl.package.description" rows="2"></textarea></td>
                                    <td><input type="text" class="form-control" ng-model="$ctrl.package.link" /></td>
                                    <td><input type="text" class="form-control" ng-model="$ctrl.package.icon" /></td>
                                    <td><input type="text" class="form-control" ng-model="$ctrl.package.publisher" /></td>
                                    <td><input type="number" class="form-control" ng-model="$ctrl.package.showIndex" /></td>
                                    <td><button type="button" class="btn btn-success btn-sm" ng-click="$ctrl.postApiResourcePackage()">添加</button></td>
                                </tr>
                                <tr ng-repeat="x in $ctrl.packages">
                                    <td>{{$index+1}}</td>
                                    <td>
                                        <b>{{x.rowKey}}</b>
                                        <br />
                                        <small am-time-ago="x.timestamp"></small>
                                    </td>
                                    <td>
                                        <select class="form-control" ng-model="x.packagePlatform" ng-options="item for item in $ctrl.packagePlatforms"></select>
                                    </td>
                                    <td><input type="text" class="form-control" ng-model="x.language" /></td>
                                    <td><input type="text" class="form-control" ng-model="x.tags" /></td>
                                    <td><textarea class="form-control" ng-model="x.description" rows="2"></textarea></td>
                                    <td><input type="text" class="form-control" ng-model="x.link" /></td>
                                    <td><input type="text" class="form-control" ng-model="x.icon" /></td>
                                    <td><input type="text" class="form-control" ng-model="x.publisher" /></td>
                                    <td><input type="number" class="form-control" ng-model="x.showIndex" /></td>
                                    <td>
                                        <button type="button" class="btn btn-link btn-sm" ng-click="$ctrl.putApiResourcePackage(x)">更新</button>
                                        <br />
                                        <button type="button" class="btn btn-link btn-sm" ng-click="$ctrl.delApiResourcePackage(x.rowKey)">删除</button>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                    
                </div>
            </div>

       
    <br />  <br />
</div>